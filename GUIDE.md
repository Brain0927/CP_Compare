# 🛍️ AI CP 值比較器 - 完整使用指南

## 📖 目錄

1. [安裝步驟](#安裝步驟)
2. [初始配置](#初始配置)
3. [使用教程](#使用教程)
4. [常見問題](#常見問題)
5. [系統架構](#系統架構)
6. [進階設定](#進階設定)

---

## 🔧 安裝步驟

### 要求
- Python 3.8+
- pip (Python 套件管理器)
- 網路連線（用於 API 呼叫）

### 步驟 1: 克隆或下載專案

```bash
# 使用 Git 克隆
git clone <repository-url>
cd CP_Compare

# 或直接下載並解壓縮
```

### 步驟 2: 建立虛擬環境

```bash
# Windows
python -m venv venv
venv\Scripts\activate

# macOS / Linux
python3 -m venv venv
source venv/bin/activate
```

### 步驟 3: 安裝依賴

```bash
pip install -r requirements.txt
```

> 💡 **提示**: 首次安裝可能需要 3-5 分鐘，取決於網路速度。

### 步驟 4: 配置 Gemini API

```bash
# 複製環境變數示例
cp .env.example .env  # macOS/Linux
# 或
copy .env.example .env  # Windows
```

編輯 `.env` 檔案：
```
GEMINI_API_KEY=your_actual_api_key_here
```

獲取 API 金鑰：
1. 訪問 [Google AI Studio](https://makersuite.google.com/app/apikey)
2. 點擊「Create API Key」
3. 複製金鑰到 `.env` 中

---

## 🎯 初始配置

### 快速測試

在啟動應用前，先驗證環境：

```bash
python test.py
```

預期輸出：
```
✅ 所有測試通過！系統可以開始使用。
```

### 首次啟動

```bash
# 方式 1: 使用啟動腳本 (macOS/Linux)
chmod +x run.sh
./run.sh

# 方式 2: 直接使用 Streamlit
streamlit run app.py
```

應用將自動開啟在 `http://localhost:8501`

---

## 📚 使用教程

### 場景 1: 比較筆記型電腦

#### 情景
你想買一台筆電，看中了 3 款，但不知道哪個性價比最高。

#### 操作步驟

**1️⃣ 準備商品連結**

訪問購物網站（Momo、PChome 等），複製 3 個筆電的完整 URL。

範例：
```
https://www.momoshop.com.tw/product/MacBook-Pro-14
https://www.pchome.com.tw/product/Dell-XPS-13
https://www.shopee.tw/product/ASUS-VivoBook-14
```

**2️⃣ 輸入連結**

- 開啟應用主頁面
- 在「📝 第一步：輸入商品連結」區域
- 每行貼一個 URL
- 選擇爬蟲模式：
  - ☐ 靜態頁面（預設，快速）
  - ☑️ 動態頁面（較慢但支援 JS 動態載入）

> 📌 提示：大多數電商平台使用「靜態」即可。若爬取失敗，試試「動態」。

**3️⃣ 開始爬取**

點擊「開始爬取」按鈕

系統將：
- 📥 下載頁面內容
- 🔍 提取商品資訊
- ✅ 顯示成功訊息

預期耗時：5-15 秒

**4️⃣ 查看爬取結果**

在「📦 第二步：商品資訊預覽」看到：
- 商品名稱
- 價格
- 評分
- 特徵數量

點擊「🔍 查看詳細規格」展開完整資訊

**5️⃣ 輸入個人需求（可選）**

例如：
> "我需要效能好且續航長的筆電，用於視訊會議和文書工作"

這有助於 AI 更精準地分配特徵權重。

**6️⃣ AI 分析**

點擊「進行 AI 分析」按鈕

系統將使用 Gemini API：
- 🧠 分析各特徵重要性
- 💬 評估用戶評論情緒
- 📊 提取評論中的特徵提及

耗時：3-5 秒

**7️⃣ 調整權重（可選）**

在「⚖️ 第三步：調整特徵權重」區域，根據個人偏好調整：

例如筆電場景：
- **CPU** (效能): 3 分 ⭐⭐⭐ （很重要）
- **RAM** (多工): 2 分 ⭐⭐ （中等重要）
- **Battery** (續航): 2 分 ⭐⭐ （中等重要）
- **Weight** (便攜): 1 分 ⭐ （較不重要）
- **Screen** (螢幕): 1 分 ⭐ （較不重要）

> 💡 使用 slider 直觀調整 1-3 分。

**8️⃣ 查看比較結果**

系統自動計算並展示：

- **表格**：所有商品的詳細對比
- **柱狀圖**：CP 值排行榜 📊
- **推薦排名**：TOP 3 推薦

**9️⃣ 閱讀 AI 推薦理由**

在「🏆 第五步：推薦結果與原因」看到：
- 詳細推薦分析（中文）
- 推薦商品的優勢說明
- 適用場景建議

**🔟 做出決定**

根據 CP 值、特徵和推薦理由，選擇最適合的商品！

---

### 場景 2: 比較智能手機

#### 特殊考慮

手機的主要特徵通常是：
- **CPU** (效能)
- **Camera** (相機)
- **Battery** (電池)
- **Screen** (螢幕)
- **RAM** (記憶體)

#### 操作提示

1. 準備 2-3 款同價位或同系列的手機連結
2. 使用場景需求如："日常拍照和遊戲"
3. 特徵權重建議：
   - Camera: 3 (如果重視拍照)
   - CPU: 3 (如果重視效能)
   - Battery: 2 (中等重要)
   - Screen: 2 (中等重要)

---

### 場景 3: 比較耳機

#### 特殊考慮

耳機屬於主觀評測產品，系統建議：

1. 多看評論（評論通常描述音質、佩戴感等）
2. 手動調整權重
3. 特徵權重建議：
   - Audio Quality: 3
   - Comfort: 2
   - Battery: 2
   - Brand: 1

---

## ❓ 常見問題

### Q1: API 金鑰無效怎麼辦？

**症狀**: 錯誤訊息 "Invalid API Key"

**解決方案**:
1. 訪問 [Google AI Studio](https://makersuite.google.com/app/apikey)
2. 生成新的 API 金鑰
3. 複製到 `.env` 檔案
4. 重啟應用

### Q2: 爬蟲無法擷取商品怎麼辦？

**可能原因及解決**:

| 原因 | 解決方案 |
|------|---------|
| URL 無效 | 確認複製完整 URL，試試瀏覽器打開 |
| 網站反爬蟲 | 勾選「動態載入」或稍後重試 |
| 網路問題 | 檢查網路連線 |
| 網站格式變更 | 嘗試其他平台的商品連結 |

### Q3: 為什麼 CP 值計算差異很大？

**原因分析**:

CP 值對價格很敏感。如果 3 款商品價格相差很大，CP 值差異就會很明顯。

例如：
- 商品 A: 規格好，但價格 $50,000 → CP 值低
- 商品 B: 規格中等，但價格 $25,000 → CP 值高

> 💡 **提示**: 調整權重或查看"推薦原因"了解細節。

### Q4: 評分加成是什麼？

**解釋**:

系統在計算 CP 值時，會根據評分給予加成：

- 5 星評分: +20% 加成
- 4 星評分: +16% 加成
- 3 星評分: +12% 加成

這反映了用戶滿意度對價值的影響。

### Q5: 支援多少個商品比較？

**限制**:
- 最少: 2 個
- 最多: 4 個
- 建議: 3 個（最容易看出差異）

### Q6: 能否保存比較結果？

**目前狀況**: 
- ❌ 自動保存（開發中）
- ✅ 手動截圖表格
- ✅ 複製表格數據

**未來功能**:
- 導出 Excel/PDF
- 保存為對比報告

### Q7: 能否比較不同類別的商品？

**不建議**。系統設計用於同類商品比較。

例如：
- ✅ 筆電 vs 筆電
- ✅ 手機 vs 手機
- ❌ 筆電 vs 手機

---

## 🏗️ 系統架構

### 模組組成

```
┌─────────────────────────────────────┐
│      Streamlit 使用者介面層          │ (app.py)
└────────┬────────────────────────────┘
         │
         ├─────────────────────┬─────────────────────┐
         │                     │                     │
    ┌────▼─────┐        ┌─────▼──────┐      ┌──────▼─────┐
    │ scraper   │        │ data_      │      │ nlp_       │
    │ (爬蟲)    │        │ cleaner    │      │ analyzer   │
    │           │        │ (清洗)     │      │ (NLP分析)  │
    └────┬─────┘        └─────┬──────┘      └──────┬─────┘
         │                     │                     │
         │  Raw Product        │  Clean Data        │  Feature
         │  Data               │                    │  Weights
         │                     │                     │
         └────────────────┬────────────────────────┘
                          │
                    ┌─────▼──────────────┐
                    │ cp_calculator      │
                    │ (CP值計算)         │
                    └─────┬──────────────┘
                          │
                    ┌─────▼──────────────┐
                    │ 視覺化輸出         │
                    │ - 排行榜           │
                    │ - 圖表             │
                    │ - 推薦理由         │
                    └────────────────────┘
```

### 資料流程

```
URL 輸入
   │
   ▼
【爬蟲模組】(scraper.py)
   ├─ HTML 下載
   ├─ DOM 解析
   └─ 數據提取
      │ 商品名稱
      │ 價格
      │ 規格
      │ 評論
   │
   ▼
【清洗模組】(data_cleaner.py)
   ├─ 單位標準化
   ├─ 特徵名稱標準化
   └─ 文本清洗
   │
   ▼
【NLP模組】(nlp_analyzer.py) + Gemini API
   ├─ 特徵重要性分析
   ├─ 評論情緒分析
   └─ 推薦理由生成
   │
   ▼
【計算模組】(cp_calculator.py)
   ├─ 特徵分數計算
   ├─ CP 值計算
   └─ 排名生成
   │
   ▼
【展示層】(app.py)
   ├─ 表格展示
   ├─ 圖表繪製
   └─ 推薦輸出
```

---

## ⚙️ 進階設定

### 自訂爬蟲規則

編輯 `utils/scraper.py`：

```python
# 自訂 CSS 選擇器
def _extract_name(self, soup):
    # 添加平台特定的選擇器
    selectors = [
        '.your-custom-selector',  # 添加自訂選擇器
        'h1',
        '.product-title',
    ]
    for selector in selectors:
        elem = soup.select_one(selector)
        if elem:
            return elem.get_text(strip=True)
    return "未知商品"
```

### 擴展特徵庫

編輯 `config/settings.py`：

```python
COMMON_FEATURES = [
    "價格", "CPU", "RAM", "儲存", "螢幕", "電池", "重量",
    # 添加新特徵
    "音質", "防水等級", "充電速度",
]
```

### 修改權重範圍

編輯 `config/settings.py`：

```python
# 預設 1-3 分，可改為 1-5 或 0-1
WEIGHT_RANGE = (1, 5)
DEFAULT_FEATURE_WEIGHT = 2.5
```

### 調整 CP 值公式

編輯 `utils/cp_calculator.py` 中的 `calculate_cp_value` 方法：

```python
# 修改加成係數
rating_bonus = 1 + (product.get('rating', 0) / 5.0) * 0.5  # 改為 50% 加成

# 或添加其他因素
brand_bonus = 1.1 if is_premium_brand(product['name']) else 1.0
final_cp = base_cp * rating_bonus * brand_bonus
```

---

## 🚀 下一步

推薦的使用流程：

1. ✅ 完成安裝和配置
2. ✅ 執行 `python test.py` 驗證環境
3. ✅ 啟動應用 `streamlit run app.py`
4. ✅ 使用樣本商品測試功能
5. ✅ 用實際商品連結進行比較
6. ✅ 根據結果調整權重

---

## 📞 技術支援

如遇問題，請查看：

1. **README.md** - 專案概述和架構
2. **本檔案** - 詳細使用指南
3. **代碼註釋** - 各模組的內部文檔
4. **test.py** - 功能測試腳本

---

**祝你使用愉快！🎉**
